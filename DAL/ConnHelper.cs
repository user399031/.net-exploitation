using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data;
using System.Data.OleDb;
using System.Data.SqlClient;
using System.Configuration;

namespace DAL
{
    public class ConnHelper
    {
        private static string connectionString = ConfigurationManager.ConnectionStrings["myConn"].ConnectionString;
        public static DataTable getDT(string strSQL)
        {
            SqlConnection conn = new SqlConnection(connectionString);
            conn.Open();

            SqlDataAdapter da = new SqlDataAdapter(strSQL, conn);
            DataTable dt = new DataTable();
            da.Fill(dt);
            conn.Close();
            return dt;
        }
        //public static List<string> GetDistinceColoum(string strSQL, string str1)
        //{
        //    DataTable dt = GetDataTable(strSQL);
        //    List<string> strList = new List<string>();
        //    foreach (DataRow dr in dt.Rows)
        //    {
        //        string str = dr[str1].ToString();
        //        strList.Add(str);
        //    }
        //    return strList;
        //}
        //public static DataTable GetDistinceColoum(string strSQL)
        string currFilepath = string.Empty;//DLL层的两个全局变量
        string currFileExtension = string.Empty;
        public DataTable LoadExcel(string path,string tabelname)
        {
            //Label1.Text = FileUpload1.PostedFile.FileName;
            string strConn = "provider=microsoft.jet.oledb.4.0;data source='" + path + "';Extended Properties=Excel 8.0";
            OleDbConnection conn = new OleDbConnection(strConn);
            conn.Open();
            string strSQL = "select * from ["+tabelname+"$]";
            DataTable dt = new DataTable();
            OleDbDataAdapter da = new OleDbDataAdapter(strSQL, conn);
            da.Fill(dt);

            conn.Close();
            return dt;
        }
        public void Upload(HttpPostedFile fname)
        {
            string tim = DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss fff").Replace(":", " ");
            HttpPostedFile file =fname;
            string fileName = file.FileName;
            string tempPath = System.IO.Path.GetTempPath();
            //string tempPath = Server.MapPath("./") + "ddd\\";
            // Label1.Text = tempPath;
            fileName = System.IO.Path.GetFileName(fileName);
            this.currFileExtension = System.IO.Path.GetExtension(fileName);
            this.currFilepath = tempPath + tim + " " + fileName;
            file.SaveAs(this.currFilepath);
            //Label1.Text = currFilepath;
        }
        public string GETPath()
        {
            return currFilepath;
        }
        //private static string connectionString = ConfigurationManager.ConnectionStrings["myConn"].ConnectionString;
        public static void AddData2Databass(string strSQL)
        {
            SqlConnection conn = new SqlConnection(connectionString);
            conn.Open();

            SqlCommand cmd = new SqlCommand(strSQL, conn);
            cmd.ExecuteNonQuery();
            conn.Close();
        }
    }
}
